jQuery.cookie = function (name, value, options) { if (typeof value != "undefined") { options = options || {}; if (value === null) { value = ""; options = $.extend({}, options); options.expires = -1 } var expires = ""; if (options.expires && (typeof options.expires == "number" || options.expires.toUTCString)) { var date; if (typeof options.expires == "number") { date = new Date(); date.setTime(date.getTime() + options.expires * 24 * 60 * 60 * 1e3) } else { date = options.expires } expires = "; expires=" + date.toUTCString() } var path = options.path ? "; path=" + options.path : ""; var domain = options.domain ? "; domain=" + options.domain : ""; var secure = options.secure ? "; secure" : ""; document.cookie = [name, "=", encodeURIComponent(value), expires, path, domain, secure].join("") } else { var cookieValue = null; if (document.cookie && document.cookie != "") { var cookies = document.cookie.split(";"); for (var i = 0; i < cookies.length; i++) { var cookie = jQuery.trim(cookies[i]); if (cookie.substring(0, name.length + 1) == name + "=") { cookieValue = decodeURIComponent(cookie.substring(name.length + 1)); break } } } return cookieValue } }; jQuery.window = function (winTitle, winWidth, winHeight, winSrc, winText, bReresh) { if (typeof winTitle == "undefined" || winTitle == "") { winTitle = "模态展示窗口" } if (typeof winWidth == "undefined" || winWidth == "" || parseInt(winWidth) == 0) { winWidth = 800 } if (typeof winHeight == "undefined" || winHeight == "" || parseInt(winHeight) == 0) { winHeight = 600 } if (typeof winSrc == "undefined") { winSrc = "" } if (typeof bReresh == "undefined") { bReresh = false } $.loading("block"); var _bodyWidth = $(window).width(); var _bodyHeight = $(document).height(); if ($("BODY", parent.parent.parent.document).size() > 0) { _bodyWidth = $("BODY", parent.parent.parent.document).width(); _bodyHeight = $("BODY", parent.parent.parent.document).height() } var reg = /\d%$/; if (reg.test(winWidth)) { winWidth = _bodyWidth * winWidth.replace("%", "") / 100 } if (reg.test(winHeight)) { winHeight = _bodyHeight * winHeight.replace("%", "") / 100 } var _dialogWidth = winWidth > _bodyWidth ? _bodyWidth : winWidth; var _dialogHeight = winHeight > _bodyHeight ? _bodyHeight : winHeight; var _MaskDiv = $("<div id='j-modal-dialog'><div class='modal-dialog-mask'></div></div>"); _MaskDiv.width(_bodyWidth); _MaskDiv.height("100%"); var _modal_dialog_panel = $("<div class='modal-dialog-panel'></div>"); _modal_dialog_panel.css({ width: _dialogWidth, height: _dialogHeight, top: 30, left: (_bodyWidth - _dialogWidth) / 2 }); var _modal_dialog_header = $("<div class='modal-dialog-header'></div>"); var _modal_dialog_title = $("<div class='modal-dialog-title'></div>").text(winTitle); var _modal_dialog_icon = $("<div class='modal-dialog-icon icon-folder'></div>"); var _modal_dialog_tool = $("<div class='modal-dialog-tool'></div>"); var _modal_dialog_close = $('<a href="javascript:void(0)" class="icon-no"></a>'); _modal_dialog_close.click(function () { _MaskDiv.remove(); if (bReresh) { $.loading("block"); window.location.href = document.URL; $("body").load(function () { $.loading("none") }) } }); _modal_dialog_tool.append(_modal_dialog_close); _modal_dialog_header.append(_modal_dialog_title).append(_modal_dialog_icon).append(_modal_dialog_tool); var _modal_dialog_body = $("<div class='modal-dialog-body'></div>"); var _modal_dialog_iframe = $("<iframe class='modal-dialog-iframe'></iframe>"); _modal_dialog_iframe.attr({ frameborder: 0, framespacing: 0, marginheight: 0, marginwidth: 0, src: winSrc }); _modal_dialog_iframe.load(function () { $.loading("none") }); if (winSrc != "") { _modal_dialog_body.css({ height: _dialogHeight - 27 }).append(_modal_dialog_iframe) } else { _modal_dialog_body.css({ height: _dialogHeight - 27, overflow: "auto" }).html(winText); $.loading("none") } _modal_dialog_panel.append(_modal_dialog_header).append(_modal_dialog_body); _MaskDiv.append(_modal_dialog_panel); if ($("BODY", parent.parent.parent.document).size() > 0) { _MaskDiv.appendTo($("BODY", parent.parent.parent.document)) } else { _MaskDiv.appendTo($("BODY")) } }; jQuery.loading = function (status) { var _id = "j-object-loading"; var _loading = $("BODY", parent.parent.parent.document).find("#j-object-loading"); if (_loading.size() > 0) { _loading.css("display", status) } else { var _winHeight = $(window).height(); var _winWidth = $(window).width(); var _outDivStyle = { position: "absolute", left: "0", display: status, width: "100%", height: "100%", "background-color": "#E0ECFF", border: "0", "text-align": "center", top: "0", opacity: "0.8", filter: "alpha(opacity=80)", "z-index": "9999999" }; var _innerDivStyle = { position: "relative", "margin-top": (_winHeight - 200) / 2 + "px", "margin-left": (_winWidth - 200) / 2 + "px", "float": "left", cursor: "wait", width: "200px", "line-height": "40px", "background-color": "#fff", border: "2px solid #ccc", color: "#000" }; var _imgStyle = { position: "absolute", top: "12px", left: "3px" }; var _divLoding = $("<div id='" + _id + "'><div id='j-object-loading-inner'><img id='j-object-loading-img' alt='' />Loading Data，Please Wait...</div></div>"); _divLoding.css(_outDivStyle); _divLoding.find("#j-object-loading-inner").css(_innerDivStyle); _divLoding.find("#j-object-loading-img").attr("src", "../images/loading.gif").css(_imgStyle); $("BODY", parent.parent.parent.document).append(_divLoding) } }; (function ($) { $.fn.Calculator = function (options) { var defaults = { panelground: "#d2e0f0", keyground: "#fff", keyout: "#9B96CA", keyover: "#fff" }; var opt = $.extend(defaults, options); var id = "JULIA-CALCULATOR"; return this.each(function () { $("#" + id).remove(); var target = $(this); var _html = '<div id="' + id + '" style="width: 180px; display:block; text-align:left; position:absolute; z-index:9999; background-color:' + opt.panelground + "; font-size:12px; " + '">'; _html += "   <div>"; _html += "      <ul>"; _html += "          <li>1</li>"; _html += "          <li>2</li>"; _html += "          <li>3</li>"; _html += "          <li>退格</li>"; _html += "      </ul>"; _html += "  </div>"; _html += "  <div>"; _html += "      <ul>"; _html += "          <li>4</li>"; _html += "          <li>5</li>"; _html += "          <li>6</li>"; _html += "          <li> </li>"; _html += "      </ul>"; _html += "  </div>"; _html += "  <div>"; _html += "      <ul>"; _html += "          <li>7</li>"; _html += "          <li>8</li>"; _html += "          <li>9</li>"; _html += "          <li>清空</li>"; _html += "      </ul>"; _html += "  </div>"; _html += "  <div>"; _html += "      <ul>"; _html += "          <li>0</li>"; _html += "          <li>.</li>"; _html += "          <li>-</li>"; _html += "          <li>关闭</li>"; _html += "      </ul>"; _html += "  </div>"; _html += "</div>"; $(target).after(_html); $("#" + id).css({ left: $(target).offset().left + $(target).width() + 5 + "px", top: $(target).offset().top + "px" }); $("#" + id + " DIV").css({ width: "100%", "margin-top": "2px", "text-align": "center" }); $("#" + id + " DIV UL").css({ margin: "0px", padding: "0px", "line-height": "30px", "list-style": "none" }); $("#" + id + " DIV UL LI").css({ width: "40px", "background-color": opt.keyground, "float": "left", "margin-left": "2px", border: "solid 1px silver", cursor: "pointer" }); $("#" + id).fadeIn(); $("#" + id + " li").click(function () { if ($(this).html().length > 0) { var maxLength = 9999; if ($(target).attr("maxlength") != undefined && $(target).attr("maxlength") != null) { maxLength = $(target).attr("maxlength") } if ($(this).html() == " ") { return false } else if ($(this).html() == ".") { if ($(target).val().length == 0) { $(target).val("0.") } else if ($(target).val() == "-") { $(target).val("-0.") } else { if ($(target).val().indexOf(".") == -1) { $(target).val($(target).val() + $(this).html()) } } } else if ($(this).html() == "-") { $(target).val("-") } else if ($(this).html() == "清空") { $(target).val("") } else if ($(this).html() == "关闭") { $("#" + id).remove() } else if ($(this).html() == "退格") { if ($(target).val().length > 0) { $(target).val($(target).val().substring(0, $(target).val().length - 1)) } } else { if ($(target).val().length == 1 && $(target).val() == "0") { $(target).val($(this).html()) } else { $(target).val($(target).val() + $(this).html()) } } if (maxLength <= $(target).val().length) { $(target).val($(target).val().substring(0, maxLength)) } } return false }).hover(function () { $(this).css("background-color", opt.keyout) }, function () { $(this).css("background-color", opt.keyover) }); $(document).click(function (e) { $("#" + id).remove() }) }) }; $.fn.datePicker = function (options) { var defaults = { language: "cn" }; var opt = $.extend(defaults, options); var id = "JULIA-DATEPICKER"; function renderHeader(year, month) { var header = '<div id="' + id + '" style="width: 280px; display:none; text-align: center; position: absolute;'; header += '         background-color: #d2e0f0; font-size: 12px; z-index:9999;">'; header += '           <table style="width: 100%; text-align: center;" cellpadding="0" cellspacing="0">'; header += "               <tr>"; header += '                   <td style="height: 25px">'; header += '                       <span id="spanPreYear' + id + '" style="cursor: pointer;"><<</span></td>'; header += '                   <td style="height: 25px" colspan="5">'; if (opt.language == "cn") { header += '                       <span id="spanPreMonth' + id + '" style="cursor: pointer;"><</span>    <span id="spanYear' + id + '">' + year + "</span>年 <span"; header += '                           style="cursor: pointer;" id="spanMonth' + id + '">' + month + '</span>月    <span id="spanNextMonth' + id + '"' } else { header += '                       <span id="spanPreMonth' + id + '" style="cursor: pointer;"><</span>    <span id="spanYear' + id + '">' + year + "</span> - <span"; header += '                           style="cursor: pointer;" id="spanMonth' + id + '">' + month + '</span>    <span id="spanNextMonth' + id + '"' } header += '                               style="cursor: pointer;">></span></td>'; header += '                   <td style="height: 25px">'; header += '                       <span id="spanNextYear' + id + '" style="cursor: pointer;">>></span></td>'; header += "               </tr>"; header += "               <tr class='header' style=\"background-color: Black; color: White;\">"; if (opt.language == "cn") { header += "                   <td>日</td> <td>一</td> <td>二</td> <td>三</td> <td>四</td> <td>五</td> <td>六</td>" } else { header += "                   <td>Sun</td> <td>Mon</td> <td>Tues</td> <td>Wed</td> <td>Thur</td> <td>Fri</td> <td>Sat</td>" } header += "               </tr>"; header += "           </table>"; header += "       </div>"; return header } function renderBody(year, month) { var today = new Date(); var target_year = year; var target_month = month; target_month = target_month - 1; var month_first_date = new Date(target_year, target_month, 1); var month_first_day = month_first_date.getDay(); var month_middle_date = new Date(target_year, target_month, 28); var month_last_date = new Date(month_middle_date.valueOf() + 4 * 24 * 60 * 60 * 1e3); month_last_date = new Date(month_last_date.getFullYear(), month_last_date.getMonth(), 1); month_last_date = new Date(month_last_date.valueOf() - 24 * 60 * 60 * 1e3); var month_last_day = month_last_date.getDay(); var during_days = 1 + (month_last_date.valueOf() - month_first_date.valueOf()) / (24 * 60 * 60 * 1e3); var begin = 0; var end = during_days; if (month_first_day > 0) { begin -= month_first_day } if (month_last_day < 6) { end += 6 - month_last_day } var body = '<tr class="calender_week">'; for (var i = begin; i < end; i++) { var dd = new Date(month_first_date.valueOf() + i * 24 * 60 * 60 * 1e3); if (dd.getDay() == 0) { body += '</tr><tr class="calender_week">'; if (i < 0 || i >= during_days) { body += '<td class="disable_day">' + dd.getDate() + "</td>" } else { body += "<td class=\"calender_day\" onmouseover=\"$(this).css('background-color', '#fff');\" onmouseout=\"$(this).css('background-color', '#d2e0f0');\">" + dd.getDate() + "</td>" } } else { if (i < 0 || i >= during_days) { body += '<td class="disable_day" style=" border-left: solid 1px #fff;">' + dd.getDate() + "</td>" } else { if (dd.getFullYear() == today.getFullYear() && dd.getMonth() == today.getMonth() && dd.getDate() == today.getDate()) { body += "<td class=\"calender_day calender_today\" style=\" border-left: solid 1px #fff;\" onmouseover=\"$(this).css('background-color', '#fff');\" onmouseout=\"$(this).css('background-color', '#d2e0f0');\">" + dd.getDate() + "</td>" } else { body += "<td class=\"calender_day\" style=\" border-left: solid 1px #fff;\" onmouseover=\"$(this).css('background-color', '#fff');\" onmouseout=\"$(this).css('background-color', '#d2e0f0');\">" + dd.getDate() + "</td>" } } } } body += "</tr>"; return body } return this.each(function () { $("#" + id).remove(); var _target = $(this); var current_date = new Date(); if ($(_target).val().length > 0) { current_date = new Date(Date.parse($(_target).val().replace(/-/g, "/"))) } if (isNaN(current_date)) { if (opt.language == "cn") { alert("日期格式只能是YYYY-MM-DD！例如：2013-4-15！") } else { alert("Date Fomat:YYYY-MM-DD！Example：2013-4-15！") } return } var year = current_date.getFullYear(); var month = current_date.getMonth(); $(_target).after(renderHeader(year, month + 1)); if (/msie/.test(navigator.userAgent.toLowerCase())) { $("#" + id).css({ left: $(_target).offset().left + $(_target).width() + 5 + "px", top: $(_target).offset().top + "px" }) } else { $("#" + id).css({ left: $(_target).offset().left + $(_target).width() + 5 + "px", top: $(_target).offset().top + "px" }) } $("#" + id + " TABLE").append(renderBody(year, month + 1)); $("#" + id + " .header TD").css({ width: "40px", height: "24px" }); $("#" + id + " .calender_week .disable_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", "background-color": "Silver" }); $("#" + id + " .calender_week .calender_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", cursor: "pointer" }); $("#" + id + " .calender_week .calender_today").css({ width: "40px", height: "24px", border: "solid 1px red", cursor: "pointer" }); $("#" + id).fadeIn(); $("#spanPreYear" + id).click(function () { var now = new Date($("#spanYear" + id).text(), 0, 1); now = now.valueOf(); now = now - 24 * 60 * 60 * 1e3; now = new Date(now); $("#spanYear" + id).text(now.getFullYear()); var month = $("#spanMonth" + id).text(); $("#" + id + " .calender_week").remove(); $("#" + id + " TABLE").append(renderBody(now.getFullYear(), month)); $("#" + id + " .header TD").css({ width: "40px", height: "24px" }); $("#" + id + " .calender_week .disable_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", "background-color": "Silver" }); $("#" + id + " .calender_week .calender_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", cursor: "pointer" }); $("#" + id + " .calender_week .calender_today").css({ width: "40px", height: "24px", border: "solid 1px red", cursor: "pointer" }); $("#" + id + " .calender_day").click(function () { $(_target).val($("#spanYear" + id).text() + "-" + $("#spanMonth" + id).text() + "-" + $(this).text()); $("#" + id).remove() }); return false }); $("#spanNextYear" + id).click(function () { var now = new Date($("#spanYear" + id).text(), 11, 31); now = now.valueOf(); now = now + 24 * 60 * 60 * 1e3; now = new Date(now); $("#spanYear" + id).text(now.getFullYear()); var month = $("#spanMonth" + id).text(); $("#" + id + " .calender_week").remove(); $("#" + id + " TABLE").append(renderBody(now.getFullYear(), month)); $("#" + id + " .header TD").css({ width: "40px", height: "24px" }); $("#" + id + " .calender_week .disable_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", "background-color": "Silver" }); $("#" + id + " .calender_week .calender_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", cursor: "pointer" }); $("#" + id + " .calender_week .calender_today").css({ width: "40px", height: "24px", border: "solid 1px red", cursor: "pointer" }); $("#" + id + " .calender_day").click(function () { var year = $("#spanYear" + id).text(); var month = $("#spanMonth" + id).text(); var day = $(this).text(); if (month.length == 1) { month = "0" + month } if (day.length == 1) { day = "0" + day } $(_target).val(year + "-" + month + "-" + day); $("#" + id).remove() }); return false }); $("#spanPreMonth" + id).click(function () { var now = new Date($("#spanYear" + id).text(), $("#spanMonth" + id).text() - 1, 1); now = now.valueOf(); now = now - 24 * 60 * 60 * 1e3; now = new Date(now); $("#spanYear" + id).text(now.getFullYear()); var month = now.getMonth(); month = month + 1; $("#spanMonth" + id).text(month); $("#" + id + " .calender_week").remove(); $("#" + id + " TABLE").append(renderBody(now.getFullYear(), month)); $("#" + id + " .header TD").css({ width: "40px", height: "24px" }); $("#" + id + " .calender_week .disable_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", "background-color": "Silver" }); $("#" + id + " .calender_week .calender_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", cursor: "pointer" }); $("#" + id + " .calender_week .calender_today").css({ width: "40px", height: "24px", border: "solid 1px red", cursor: "pointer" }); $("#" + id + " .calender_day").click(function () { var year = $("#spanYear" + id).text(); var month = $("#spanMonth" + id).text(); var day = $(this).text(); if (month.length == 1) { month = "0" + month } if (day.length == 1) { day = "0" + day } $(_target).val(year + "-" + month + "-" + day); $("#" + id).remove() }); return false }); $("#spanNextMonth" + id).click(function () { var now = new Date($("#spanYear" + id).text(), $("#spanMonth" + id).text() - 1, 28); now = now.valueOf(); now = now + 4 * 24 * 60 * 60 * 1e3; now = new Date(now); $("#spanYear" + id).text(now.getFullYear()); var month = now.getMonth(); month = month + 1; $("#spanMonth" + id).text(month); $("#" + id + " .calender_week").remove(); $("#" + id + " TABLE").append(renderBody(now.getFullYear(), month)); $("#" + id + " .header TD").css({ width: "40px", height: "24px" }); $("#" + id + " .calender_week .disable_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", "background-color": "Silver" }); $("#" + id + " .calender_week .calender_day").css({ width: "40px", height: "24px", "border-top": "solid 1px #fff", cursor: "pointer" }); $("#" + id + " .calender_week .calender_today").css({ width: "40px", height: "24px", border: "solid 1px red", cursor: "pointer" }); $("#" + id + " .calender_day").click(function () { var year = $("#spanYear" + id).text(); var month = $("#spanMonth" + id).text(); var day = $(this).text(); if (month.length == 1) { month = "0" + month } if (day.length == 1) { day = "0" + day } $(_target).val(year + "-" + month + "-" + day); $("#" + id).remove() }); return false }); $("#" + id + " .calender_day").click(function () { var year = $("#spanYear" + id).text(); var month = $("#spanMonth" + id).text(); var day = $(this).text(); if (month.length == 1) { month = "0" + month } if (day.length == 1) { day = "0" + day } $(_target).val(year + "-" + month + "-" + day); $("#" + id).remove(); return false }); $("#" + id).click(function () { return false }); $(document).click(function (e) { $("#" + id).remove() }) }) }; $.fn.toolTip = function (options) { var defaults = { title: "错误提示：", titleground: "Olive", text: "", textground: "Silver" }; var opt = $.extend(defaults, options); var id = "JULIA-TOOLTIP"; return this.each(function () { $("#" + id).remove(); var _target = $(this); var _html = '<div id="' + id + '" style="width:200px; border:solid 1px #000; position:absolute; background-color:' + opt.textground + ';">'; _html += '    <div style=" border-bottom:solid 1px #000; font-size:12px; font-weight:bold; background-color:' + opt.titleground + '; text-align:left;">' + opt.title + "</div>"; _html += '    <div style ="font-size:12px; height:70px; text-align:left;">'; _html += '        <ul style="margin-left:5px; list-style:">'; _html += opt.text; _html += "        </ul>"; _html += "    </div>"; _html += "</div>"; $(_target).after(_html); if (/msie/.test(navigator.userAgent.toLowerCase())) { $("#" + id).css({ "margin-left": "1px", "margin-top": $(_target).offset().top + "px" }) } else { $("#" + id).css({ left: $(_target).offset().left + $(_target).width() + 2 + "px", "margin-top": $(_target).offset().top + "px" }) } $(_target).click(function () { $("#" + id).remove() }) }) }; $.fn.Buyer = function (options) { var id = "JULIA-BUYER"; function callBack(domain, target) { $("#" + id).find(".item").fadeOut("slow").remove(); $.ajax({ type: "get", url: "/Ajax/Buyer.ashx?domain=" + domain + "&rt=" + Date.toLocaleString(), dataType: "json", contentType: "application/json; charset=utf-8", success: function (json) { $.each(json, function (i, data) { if (domain.toUpperCase() == data.Domain) { var html = ""; html += "    <tr class='item'>"; html += "        <td>" + data.Code + "</td>"; html += "        <td>" + data.Name + "</td>"; html += "        <td>" + data.Domain + "</td>"; html += "    </tr>" } $("#" + id + " TABLE").append(html) }); $("#" + id).html($("#" + id).html()); $("#" + id + " .item TD").css({ "border-bottom": "1px dotted #b8d2f0" }); $("#" + id).fadeIn("slow"); $("#" + id).find("#selDomain").change(function () { callBack($(this).children("option:selected").val(), target) }); $("#" + id + " TABLE TR:gt(0)").click(function () { $(target).val($(this).find("TD:eq(0)").text()); return false }).hover(function () { $(this).css("background-color", "#b8d2f0") }, function () { $(this).css("background-color", "#fff") }) }, error: function () { } }) } return this.each(function () { var target = $(this); x = $(target).offset().left; y = $(target).offset().top + $(target).height() + 4; if ($("#" + id).size() > 0) { $("#" + id).css("left", x).css("top", y).fadeIn("slow"); return false } var _html = '<div id="' + id + '" style="width: 230px; display:none; background-color:#fff; text-align:center; border:1px solid #51a8ec; position:absolute; font-size:12px; margin-top:2px; left:' + x + "px; top:" + y + 'px;">'; _html += "<table style='text-align:center; line-height:20px; margin:1px; cursor:pointer;' cellpadding='2' cellspacing='0'>"; _html += "    <tr class='header' style=' background: #51a8ec; color:#fff;'>"; _html += "        <th style='width:80px;'>代码</th>"; _html += "        <th style='width:100px;'>姓名</th>"; _html += "        <th style='width:50px;'>"; _html += "          <select id='selDomain' style='font-size:11px;'>"; _html += "              <option>SZX</option>"; _html += "              <option>ZQL</option>"; _html += "              <option>YQL</option>"; _html += "              <option>HQL</option>"; _html += "          </select>"; _html += "        </th>"; _html += "    </tr>"; _html += "</table>"; _html += "</div>"; $(target).after(_html); callBack("SZX", target); $("#" + id).click(function () { return false }); $(document).click(function (e) { $("#" + id).css("display", "none") }) }) }; $.fn.AutoComplete = function (options, textChangedMethod) { var id = "JULIA-AUTOCOMPLETE"; var defaults = { cols: {}, fields: {}, eVals: {}, url: "", val: 0, isDyn: false, isImm: false, inputCls: "" }; var opt = $.extend(defaults, options); return this.each(function () { $(this).click(function () { $("#" + id).remove(); var w = 0; var target = $(this); x = $(target).offset().left; y = $(target).offset().top + $(target).height() + 4; var _html = '<div id="' + id + '" style=" display:none; background-color:#fff; text-align:center; border:1px solid #51a8ec; position:absolute; font-size:11px; margin-top:2px; left:' + x + "px; top:" + y + 'px; z-index:9999;">'; _html += "<table style='text-align:center; line-height:15px; margin:1px; cursor:pointer;' cellpadding='1' cellspacing='1'>"; _html += "    <tr style=' background: #51a8ec; color:#fff;'>"; $.each(opt.cols, function (index, obj) { _html += "        <th style='width:" + obj.width + ";'>" + obj.name + "</th>"; w += parseInt(obj.width.replace("px", "")) }); _html += "    </tr>"; var _inputVal = target.val(); var _url = opt.url; if (opt.inputCls != "" && $("." + opt.inputCls).size() > 0) { _inputVal = $("." + opt.inputCls).val() } if (opt.isImm) { _url += "?req=" + _inputVal } if (!opt.isDyn || opt.isImm) { $.ajax({ type: "get", url: _url, dataType: "json", contentType: "application/json; charset=utf-8", success: function (json) { $("#" + id).find(".item").remove(); $.each(json, function (i, data) { _html += "    <tr>"; $.each(opt.fields, function (index, obj) { _html += "        <td  style=' border-bottom:1px dotted #b8d2f0; text-align:" + obj.align + ";'>" + eval("data." + obj.val) + "</td>" }); _html += "    </tr>" }); _html += "</table>"; _html += "</div>"; $(target).after(_html); $("#" + id).fadeIn("slow"); $("#" + id + " TABLE TR:gt(0)").click(function () { $__this = $(this); $(target).val($__this.find("TD:eq(" + opt.val + ")").text()); $(target).focus(); $.each(opt.eVals, function (index, obj) { if ($("." + obj.targetCls).size() > 0) { if ($("." + obj.targetCls).prop("tagName") == "SPAN") { $("." + obj.targetCls).text($__this.find("TD:eq(" + obj.valCol + ")").text()) } else { $("." + obj.targetCls).val($__this.find("TD:eq(" + obj.valCol + ")").text()) } } }); if (textChangedMethod != null) { textChangedMethod() } return false }).hover(function () { $(this).css("background-color", "#b8d2f0") }, function () { $(this).css("background-color", "#fff") }); $(document).click(function (e) { $("#" + id).remove() }) }, error: function () { _html += "</table>"; _html += "</div>"; $(target).after(_html) } }) } else { _html += "</table>"; _html += "</div>"; $(target).after(_html) } $("#" + id).width(w); return false }); $(this).keyup(function () { if (!opt.isDyn) { return } var target = $(this); if ($(this).val().length == 0) { return false } $.ajax({ type: "get", url: opt.url + "?req=" + encodeURIComponent($(this).val()) + "&rt=" + new Date().getTime(), dataType: "json", contentType: "application/json; charset=utf-8", success: function (json) { $("#" + id).find(".item").remove(); $.each(json, function (i, data) { var html = ""; html += "<tr class='item' style=' border-bottom:1px dotted #b8d2f0;'>"; $.each(opt.fields, function (index, obj) { if (typeof eval("data." + obj.val) != "undefined") { html += "        <td  style=' border-bottom:1px dotted #b8d2f0; text-align:" + obj.align + ";'>" + eval("data." + obj.val) + "</td>" } }); html += "</tr>"; $("#" + id + " TABLE").append(html) }); $("#" + id).html($("#" + id).html()); $("#" + id).fadeIn("slow"); $("#" + id + " TABLE TR:gt(0)").click(function () { $__this = $(this); $(target).val($(this).find("TD:eq(" + opt.val + ")").text()); $(target).focus(); $.each(opt.eVals, function (index, obj) { if ($("." + obj.targetCls).size() > 0) { if ($("." + obj.targetCls).prop("tagName") == "SPAN") { $("." + obj.targetCls).text($__this.find("TD:eq(" + obj.valCol + ")").text()) } else { $("." + obj.targetCls).val($__this.find("TD:eq(" + obj.valCol + ")").text()) } } }); if (textChangedMethod != null) { textChangedMethod() } return false }).hover(function () { $(this).css("background-color", "#b8d2f0") }, function () { $(this).css("background-color", "#fff") }); $(document).click(function (e) { $("#" + id).remove() }) }, error: function (XMLHttpRequest, textStatus, errorThrown) { alert(XMLHttpRequest.status); alert(XMLHttpRequest.readyState); alert(textStatus) } }) }) }) }; $.fn.GridView = function (options) { var defaults = { rowOver: "#E1FCCE", rowSel: "#D0FBB1", colOver: "#E1FCCE", colSel: "#D0FBB1", allowRowMultiSel: false, allowColMultiSel: false, isResizable: false, isHeaderFixed: false, fixedHeight: 300, allowAutoResize: false, panelHeight: 500, showSummary: true, startIndex: 0 }; var opt = $.extend(defaults, options); opt.fixedHeight = Math.max(opt.fixedHeight, 300); opt.panelHeight = Math.max(opt.panelHeight, 500); return this.each(function () { $("#PositionLocationDiv").remove(); var $this = $(this); $type = "gv"; $top = 0; if ($this.prop("tagName") == "TABLE") { if ($this.parent().prop("tagName") == "DIV" && $this.prevAll().size() == 0 && $this.nextAll().size() == 0) { $type = "gv"; $top = $this.parent().offset().top } else { $type = "dg"; $top = $this.offset().top } } else { document.write("注意：该控件不符合使用本插件的条件！<br />本插件可供GridView、DataGrid服务器控件使用，或类似结构的Html组件使用。") } if (opt.allowAutoResize) { opt.fixedHeight = Math.max(opt.fixedHeight, opt.panelHeight - $top) } $this.wrap("<div><div></div></div>"); $this.parent().css({ width: $this.width() + (opt.isHeaderFixed ? 19 : 0) }); if (opt.isHeaderFixed) { $this.parent().parent().css({ position: "relative", width: $this.width() + (opt.isHeaderFixed ? 19 : 0), "text-align": "left" }) } else { $this.parent().parent().css({ width: $this.width() + (opt.isHeaderFixed ? 19 : 0) }) } if (opt.isHeaderFixed) { $this.parent().css({ height: Math.max(opt.fixedHeight, 400) + "px", overflow: "auto", top: 0, left: 0, "z-index": 1, "text-align": "left" }) } $this.css({ height: opt.isHeaderFixed ? "" : "100%" }); if ($type == "dg") { var _o = $(".GridViewPagerStyle TD:eq(0)", $this).html(); if (_o) { $(".GridViewPagerStyle TD:eq(0)", $this).html($(".GridViewPagerStyle TD:eq(0)", $this).html().replace(/\&nbsp\;|\&nbsp/g, "")) } $(".GridViewPagerStyle TD:eq(0)", $this).append('<table border="0"><tr></tr></table>').find("SPAN, A").each(function () { $(this).wrap("<td></td>").parent().appendTo($(".GridViewPagerStyle TD:eq(0) TABLE:eq(0) TR:eq(0)", $this)) }) } if (opt.allowAutoResize) { $(".GridViewPagerStyle TABLE:eq(0) TR:eq(0)", $this).prepend('<td style="vertical-align:middle; color:#000;"></td>').find("TD:eq(0)").html('Page<select id="GridViewPageCount" name="GridViewPageCount"><option value="30">30</option><option value="50">50</option><option value="100">100</option></select> ') } $(".GridViewPagerStyle TABLE:eq(0)", $this).css({ "float": "left" }); if (opt.showSummary) { $(".GridViewPagerStyle TD:eq(0)", $this).append('<table style=" float:right; color:#000;"><td class="GridViewInfoSummary">Avg:NaN    Count:NaN    Sum:NaN  </td><td style="width;10px; position:relative;"><img class="GridViewResizableFlag" alt="" src="" style="position:absolute; right:0; bottom:0; cursor:nw-resize; display:' + (opt.isResizable ? "block" : "none") + ' " /></td></table>') } $(".GridViewPagerStyle #GridViewPageCount", $this).val($this.attr("PageSize")); if ($(".GridViewRowStyle, .GridViewAlternatingRowStyle", $this).size() == 0) { return false } $(".GridViewRowStyle, .GridViewAlternatingRowStyle", $this).hover(function () { if ($(this).attr("rowSelected") == undefined || !$(this).attr("rowSelected")) { $(this).addClass("GridViewRowOverStyle") } }, function () { $(this).removeClass("GridViewRowOverStyle") }).click(function () { startIndex = $(this).index(); if ($(this).attr("rowSelected") == undefined) { if (!opt.allowRowMultiSel) { $("TR[rowSelected]", $(this).parent()).removeClass("GridViewRowSelectedStyle").removeAttr("rowSelected") } $(this).attr({ rowSelected: true }).addClass("GridViewRowSelectedStyle") } else { $(this).removeClass("GridViewRowSelectedStyle").removeAttr("rowSelected") } }).dblclick(function () { if ($(this).attr("rowSelected") == undefined) { if (!opt.allowRowMultiSel) { $("TR[rowSelected]", $(this).parent()).removeClass("GridViewRowSelectedStyle").removeAttr("rowSelected") } $(this).attr({ rowSelected: true }).addClass("GridViewRowSelectedStyle") } }); if (opt.isHeaderFixed) { $this.parent().before('<table class="GridViewStyle" cellspacing="0" border="1"></table>'); $("TABLE:eq(0)", $this.parent().parent()).css({ position: "absolute", width: $this.width() + 2 + "px", top: 0, left: 0, "z-index": 2, "border-collapse": "collapse" }); $this.parent().after('<table class="GridViewStyle" cellspacing="0" border="0"></table>'); $("TABLE:last", $this.parent().parent()).css({ position: "absolute", width: $(this).width(), bottom: 0, left: 0, "z-index": 2 }); $(".GridViewHeaderStyle", $this).clone().appendTo($("TABLE:eq(0)", $this.parent().parent())); $("TABLE:eq(0) TR TH, TABLE:eq(0) TR TD", $this.parent().parent()).each(function () { var ind4 = $(this).parent().find("TH, TD").index($(this)); $(this).width($(".GridViewRowStyle:eq(0) TD:eq(" + ind4 + ")", $this).width() + "px") }); $(".GridViewPagerStyle", $this).appendTo($("TABLE:last", $this.parent().parent())); $this.after('<div style="width:' + $this.width() + "px; height:" + 50 + 'px; border-left: 1px solid #b8d2f0; border-right: 1px solid #b8d2f0; "></div>') } $(".GridViewHeaderStyle:first", $this.parent().parent()).on("mouseover", "TH", function () { if ($(this).attr("colSelected") == undefined || !$(this).attr("colSelected")) { var index = $(this).parent().find("TH, TD").index($(this)); $(".GridViewHeaderStyle:last", $this).nextAll().not(".GridViewPagerStyle").each(function () { $("TD:eq(" + index + ")", $(this)).addClass("GridViewColOverStyle") }) } }).on("mouseout", "TH", function () { var index = $(this).parent().find("TH, TD").index($(this)); $(".GridViewHeaderStyle:last", $this).nextAll().not(".GridViewPagerStyle").each(function () { $("TD:eq(" + index + ")", $(this)).removeClass("GridViewColOverStyle") }) }).on("click", "TH", function () { var _flag = $(this).attr("colSelected") != undefined; if (!opt.allowColMultiSel || _flag) { $("TH[colSelected], TD[colSelected]", $(this).parent()).each(function () { $(this).removeAttr("colSelected"); var ind1 = $(this).parent().find("TH, TD").index($(this)); $(".GridViewHeaderStyle:last", $this).nextAll().not(".GridViewPagerStyle").each(function () { $("TD:eq(" + ind1 + ")", $(this)).removeClass("GridViewColSelectedStyle") }) }); if (_flag && opt.showSummary) { $(".GridViewPagerStyle .GridViewInfoSummary", $this.parent().parent()).html("Avg:NaN    Count:NaN    Sum:NaN  "); return false } } var ind2 = $(this).parent().find("TH, TD").index($(this)); $(this).attr({ colSelected: true }); $(".GridViewHeaderStyle:last", $this).nextAll().not(".GridViewPagerStyle").each(function () { $("TD:eq(" + ind2 + ")", $(this)).addClass("GridViewColSelectedStyle") }); if (opt.showSummary) { var _avg = 0; var _count = 0; var _sum = 0; $("TH[colSelected], TD[colSelected]", $(this).parent()).each(function () { var ind3 = $(this).parent().find("TH, TD").index($(this)); $(".GridViewHeaderStyle:last", $this).nextAll().not(".GridViewPagerStyle").each(function () { _count += 1; var val = parseFloat($("TD:eq(" + ind3 + ")", $(this)).text()); _sum += isNaN(val) ? 0 : val }) }); _sum = Math.round(_sum * 100) / 100; _avg = Math.round(100 * _sum / _count) / 100; $(".GridViewPagerStyle .GridViewInfoSummary", $this.parent().parent()).html("Avg:" + _avg + "    Count:" + _count + "    Sum:" + _sum + "  ") } }); var x = 0; var y = 0; var h = 0; var flag = false; $(".GridViewResizableFlag", $this.parent().parent()).mousedown(function (e) { x = e.clientX; y = e.clientY; h = $this.parent().height(); flag = true }).mousemove(function (e) { if (flag) { $this.parent().height(h + (e.clientY - y) + "px") } }).mouseup(function (e) { flag = false }).mouseout(function (e) { flag = false }); $("BODY").mouseup(function (e) { flag = false }) }) }; $.fn.contextPopup = function (menuData) { var settings = { contextMenuClass: "contextMenuPlugin", gutterLineClass: "gutterLine", headerClass: "header", seperatorClass: "divider", title: "", items: [] }; $.extend(settings, menuData); function createMenu(e) { var menu = $('<ul class="' + settings.contextMenuClass + '"><div class="' + settings.gutterLineClass + '"></div></ul>').appendTo(document.body); if (settings.title) { $('<li class="' + settings.headerClass + '"></li>').text(settings.title).appendTo(menu) } settings.items.forEach(function (item) { if (item) { var rowCode = '<li><a href="#"><span></span></a></li>'; var row = $(rowCode).appendTo(menu); if (item.icon) { var icon = $("<img>"); icon.attr("src", item.icon); icon.insertBefore(row.find("span")) } row.find("span").text(item.label); if (item.action) { row.find("a").click(function () { item.action(e) }) } } else { $('<li class="' + settings.seperatorClass + '"></li>').appendTo(menu) } }); menu.find("." + settings.headerClass).text(settings.title); return menu } this.bind("contextmenu", function (e) { var menu = createMenu(e).show(); var left = e.pageX + 5, top = e.pageY; if (top + menu.height() >= $(window).height()) { top -= menu.height() } if (left + menu.width() >= $(window).width()) { left -= menu.width() } menu.css({ zIndex: 1000001, left: left, top: top }).bind("contextmenu", function () { return false }); var bg = $("<div></div>").css({ left: 0, top: 0, width: "100%", height: "100%", position: "absolute", zIndex: 1e6 }).appendTo(document.body).bind("contextmenu click", function () { bg.remove(); menu.remove(); return false }); menu.find("a").click(function () { bg.remove(); menu.remove() }); return false }); return this } })(jQuery);