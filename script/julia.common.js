$(document).ready(function () { $("BODY").height(1); $.loading("none"); $("input:text:first").focus(); var a = $("input:text, input:checkbox, input:radio, select"); a.bind("keydown", function (f) { var b = f.which; if (b == 13) { f.preventDefault(); var d = a.index(this) + 1; var c = a[d]; if (typeof c != "undefined") { c.focus() } else { $("input:submit:first").click() } } }); $("BODY FORM").append('<div id="PositionLocationDiv" style="width:100%; height:1px; font-size:0px;line-height:1px;">&nbsp;</div>'); $(":submit").hover(function () { $(this).css("background-position", "0 -27px") }, function () { $(this).css("background-position", "0 0") }); $(":submit").on("click", function () { if ($(this).attr("disabled")) { return false } var b = true; $(".Date").each(function () { if ($(this).val().length == 0) { if ($(this).attr("class").indexOf("Required") > 0) { $(this).toolTip({ text: "不能为空!" }); b = false } } else { if (!isDate($(this).val().trim()) && !isDateTime($(this).val().trim())) { $(this).toolTip({ text: "日期格式不正确!" }); b = false } } }); $(".Numeric").each(function () { if ($(this).val().length == 0) { if ($(this).attr("class").indexOf("Required") > 0) { $(this).toolTip({ text: "不能为空!" }); b = false } } else { if (!isNumeric($(this).val())) { $(this).toolTip({ text: "请输入数字!" }); b = false } } }); $(".Int").each(function () { if ($(this).val().length == 0) { if ($(this).attr("class").indexOf("Required") > 0) { $(this).toolTip({ text: "不能为空!" }); b = false } } else { if (!/^\d+$/.test($(this).val())) { $(this).toolTip({ text: "请输入整数!" }); b = false } } }); $(".String").each(function () { if ($(this).attr("maxlength") == 2147483647) { $(this).toolTip({ text: "请至后台设置最大长度（maxlength）!" }); b = false } if ($(this).val().length == 0) { if ($(this).attr("class").indexOf("Required") > 0) { $(this).toolTip({ text: "不能为空!" }); b = false } } }); return b }); $("BODY", parent.document).find("#exportExcel").css("display", $("#hidExportExcel").val() == "1" ? "block" : "none"); $("FORM").submit(function () { $.loading("block") }); $("SELECT[onchange*=setTimeout]").change(function () { $.loading("block") }); $(":radio[onclick*=setTimeout]").click(function () { $.loading("block") }); $(":checkbox[onclick*=setTimeout]").click(function () { $.loading("block") }); $("A[href^=javascript]").on("click", function () { if ($(this).text() == "删除") { if (!confirm("你确定要删除这条记录吗？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "Del" || $(this).text() == "Delete") { if (!confirm("Are you sure you want to delete this record？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "关闭") { if (!confirm("你确定要关闭这条记录吗？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "Close") { if (!confirm("Are you sure you want to close this record？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "提交") { if (!confirm("你确定要提交这条记录吗？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "Submit") { if (!confirm("Are you sure you want to submit this record?")) { $.confirm_retValue = false; return false } } else { if ($(this).text() == "剔除") { if (!confirm("你确定要剔除这条记录吗？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "核准") { if (!confirm("你确定要核准这条记录吗？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "结算") { if (!confirm("你确定要结算这条记录吗？")) { $.confirm_retValue = false; return false } } else { if ($(this).text() == "转部件") { if (!confirm("你确定要转成部件吗？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "转产品") { if (!confirm("你确定要转成产品吗？")) { $.confirm_retValue = false; return false } } else { if ($(this).text() == "取消") { if (!confirm("你确定要取消这条记录吗？")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } else { if ($(this).text() == "CANCEL") { if (!confirm("Are you sure you want to cancel this record?")) { $.confirm_retValue = false; return false } else { $.confirm_retValue = true } } } } } } } } } } } } } } $.loading("block") }); $("#hidAutoPageSize").appendTo("FORM"); $(".GridViewStyle").each(function () { if ($(this).hasClass("GridViewRebuild")) { var o = $.cookie("WidthPixel") > $(this).width() ? $.cookie("HeightPixel") : $.cookie("HeightPixel") - 14; $(this).GridView({ isHeaderFixed: true, maxHeight: 400, allowAutoResize: true, panelHeight: o }) } else { if ($(this).hasClass("AutoPageSize")) { var k = $(".GridViewPagerStyle", this).size() > 0 ? true : false; var g = $(".GridViewRowStyle", this).size() > 0 ? true : false; var l = $(this).find(".GridViewRowStyle").size() + $(this).find(".GridViewAlternatingRowStyle").size(); var h = $("#hidIsPostBack").val(); var c = parseInt($("#hidAutoPageSize").val()); if (k && g && c == 0) { if ($(this).attr("class").indexOf("AutoPageSize") > 0) { var m = $("body", parent.document).find("#ifrm_desktop").height(); var f = m; var r = $(document).height(); var b = $(".GridViewRowStyle:first").height(); var q = $("#PositionLocationDiv").offset().top; var p = $("body", parent.document).find("#ifrm_desktop").width(); var n = $("#PositionLocationDiv").width(); $("*").each(function () { n = n > $(this).width() ? n : $(this).width() }); m = p >= n ? m : m - 16; if (m < q) { var e = 1 + Math.floor((q - m) / (b + 2)); while (e > 0) { if (l % 2 == 1) { $(".GridViewRowStyle:last").remove() } else { $(".GridViewAlternatingRowStyle:last").remove() } e = e - 1; l = l - 1 } $.ajax({ type: "POST", url: "/Ajax/AutoPageSize.ashx", data: "clientheight=" + f + "&menu=" + window.location.pathname + "&pagesize=" + l, success: function (i) { $("#hidAutoPageSize").val(l) } }) } else { var d = Math.floor((m - q) / (b + 2)); l = l + d; $.ajax({ type: "POST", url: "/Ajax/AutoPageSize.ashx", data: "clientheight=" + f + "&menu=" + window.location.pathname + "&pagesize=" + l, success: function (i) { window.location.href = window.location.href } }) } } } } $(this).GridView({ showSummary: false, isHeaderFixed: false }) } }); $(".Date").click(function () { $(this).datePicker(); return false }); $(".EnglishDate").click(function () { $(this).datePicker({ language: "en" }); return false }); $(".Numeric").click(function () { $(this).Calculator(); return false }); if ($(".Company").size() > 0) { $(".Company").AutoComplete({ cols: [{ width: "50px", name: "域名" }, { width: "130px", name: "公司名" }], fields: [{ val: "Domain", align: "center" }, { val: "Company", align: "left" }], url: "/Json/Company.json", val: "0", isDyn: false }) } $(".Buyer").click(function () { $(this).Buyer(); return false }); if ($(".Part").size() > 0) { $(".Part").AutoComplete({ cols: [{ width: "70px", name: "物料号" }, { width: "200px", name: "描述1" }, { width: "200px", name: "描述2" }], fields: [{ val: "Part", align: "center" }, { val: "Desc1", align: "left" }, { val: "Desc2", align: "left" }], eVals: [{ targetCls: "PartDesc", valCol: 1 }], url: "/Ajax/Part.ashx", val: "0", isDyn: true }) } if ($(".PartStatus").size() > 0) { $(".PartStatus").AutoComplete({ cols: [{ width: "80px", name: "零件状态" }, { width: "100px", name: "零件描述" }], fields: [{ val: "Code", align: "left" }, { val: "Desc", align: "left" }], url: "/Json/PartStatus.json", val: "0", isDyn: false }) } if ($(".Supplier").size() > 0) { $(".Supplier").AutoComplete({ cols: [{ width: "70px", name: "代码" }, { width: "200px", name: "名称" }, { width: "200px", name: "地址1" }, { width: "200px", name: "地址2" }], fields: [{ val: "Code", align: "center" }, { val: "Name", align: "left" }, { val: "Addr1", align: "left" }, { val: "Addr2", align: "left" }], url: "/Ajax/Supplier.ashx", val: "0", isDyn: true, isDyn: true, eVals: [{ targetCls: "SupplierOutput1", valCol: 0 }, { targetCls: "SupplierNameOutput", valCol: 1 }] }) } if ($(".Customer").size() > 0) { $(".Customer").AutoComplete({ cols: [{ width: "70px", name: "代码" }, { width: "200px", name: "名称" }, { width: "200px", name: "地址1" }, { width: "200px", name: "地址2" }], fields: [{ val: "Code", align: "center" }, { val: "Name", align: "left" }, { val: "Addr1", align: "left" }, { val: "Addr2", align: "left" }], url: "/Ajax/Customer.ashx", val: "0", eVals: [{ targetCls: "CustomerOutput1", valCol: 1 }], isDyn: true }) } if ($(".BOM").size() > 0) { $(".BOM").AutoComplete({ cols: [{ width: "150px", name: "零件号" }, { width: "80px", name: "每件数量" }, { width: "80px", name: "次品量" }, { width: "100px", name: "开始日期" }, { width: "100px", name: "结束日期" }], fields: [{ val: "Part", align: "Center" }, { val: "QtyPer", align: "Right" }, { val: "Scrp", align: "Right" }, { val: "StartDate", align: "Center" }, { val: "EndDate", align: "Center" }], url: "/Ajax/BOM.ashx", val: "0", eVals: [{ targetCls: "BOMOutput1", valCol: 1 }, { targetCls: "BOMOutput2", valCol: 2 }, { targetCls: "BOMOutput3", valCol: 3 }, { targetCls: "BOMOutput4", valCol: 4 }, { targetCls: "BOMOutput5", valCol: 5 }], isDyn: false, isImm: true, inputCls: "BOMInput" }) } if ($(".Item").size() > 0) { $(".Item").AutoComplete({ cols: [{ width: "120px", name: "部件号" }, { width: "300px", name: "描述" }, { width: "120px", name: "老部件号" }], fields: [{ val: "Code", align: "left" }, { val: "Desc", align: "left" }, { val: "OldCode", align: "left" }], url: "/Ajax/Item.ashx", val: "0", isDyn: true }) } if ($(".UserDomain").size() > 0) { $(".UserDomain").AutoComplete({ cols: [{ width: "80px", name: "工号" }, { width: "80px", name: "姓名" }, { width: "120px", name: "部门" }, { width: "120px", name: "岗位" }, { width: "50px", name: "公司" }], fields: [{ val: "UserNo", align: "Center" }, { val: "UserName", align: "Center" }, { val: "Dept", align: "left" }, { val: "Post", align: "left" }, { val: "Domain", align: "Center" }], eVals: [{ targetCls: "UserDomainUserNoOutput", valCol: 0 }, { targetCls: "UserDomainNameOutput", valCol: 1 }, { targetCls: "UserDomainDeptOutput", valCol: 2 }, { targetCls: "UserDomainRoleOutput", valCol: 3 }, { targetCls: "UserDomainDomainOutput", valCol: 4 }], url: "/Ajax/UserDomain.ashx", val: "0", isDyn: true }) } if ($(".User").size() > 0) { $(".User").AutoComplete({ cols: [{ width: "80px", name: "工号" }, { width: "80px", name: "姓名" }, { width: "120px", name: "部门" }, { width: "120px", name: "岗位" }, { width: "50px", name: "公司" }], fields: [{ val: "UserNo", align: "Center" }, { val: "UserName", align: "Center" }, { val: "Dept", align: "left" }, { val: "Post", align: "left" }, { val: "Domain", align: "Center" }], eVals: [{ targetCls: "UserNoOutput", valCol: 0 }, { targetCls: "UserNameOutput", valCol: 1 }, { targetCls: "UserDeptOutput", valCol: 2 }, { targetCls: "UserRoleOutput", valCol: 3 }, { targetCls: "UserDomainOutput", valCol: 4 }], url: "/Ajax/User.ashx", val: "0", isDyn: true }) } if ($(".UUser").size() > 0) { $(".UUser").AutoComplete({ cols: [{ width: "80px", name: "工号" }, { width: "80px", name: "姓名" }, { width: "120px", name: "部门" }, { width: "120px", name: "岗位" }, { width: "50px", name: "公司" }], fields: [{ val: "UserNo", align: "Center" }, { val: "UserName", align: "Center" }, { val: "Dept", align: "left" }, { val: "Post", align: "left" }, { val: "Domain", align: "Center" }], eVals: [{ targetCls: "UUserNameOutput", valCol: 1 }, { targetCls: "UUserDeptOutput", valCol: 2 }, { targetCls: "UUserRoleOutput", valCol: 3 }, { targetCls: "UUserDomainOutput", valCol: 4 }], url: "/Ajax/UUser.ashx", val: "0", isDyn: true }) } if ($(".CCPOrder").size() > 0) { $(".CCPOrder").AutoComplete({ cols: [{ width: "150px", name: "订单号" }], fields: [{ val: "poNbr", align: "center" }], eVals: [{ targetCls: "Order", valCol: 0 }], url: "/Ajax/CCPOrder.ashx", val: "0", isDyn: true }) } if ($(".CCPPart").size() > 0) { $(".CCPPart").AutoComplete({ cols: [{ width: "150px", name: "整灯号/物料号" }, { width: "200px", name: "描述1" }, { width: "200px", name: "描述2" }], fields: [{ val: "Part", align: "center" }, { val: "Desc1", align: "center" }, { val: "Desc2", align: "center" }], eVals: [{ targetCls: "Part", valCol: 0 }, { targetCls: "Desc1", valCol: 1 }, { targetCls: "Desc2", valCol: 2 }], url: "/Ajax/CCPPart.ashx", val: "0", isDyn: true }) } });